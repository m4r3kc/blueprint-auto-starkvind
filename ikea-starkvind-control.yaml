blueprint:
  name: Manualne sterowanie oczyszczaczem powietrza (wieloma)
  description: |
    <br>
    <b>ğŸ“˜Ten Blueprint wÅ‚Ä…cza oczyszczacze powietrza w trybie manualnym z okreÅ›lonÄ… mocÄ…, gdy poziom PM2.5 mieÅ›ci siÄ™ w zdefiniowanym zakresie.</b>
    <br><br>
    ğŸ“… <b>PrzeÅ‚Ä…czniki, encje, obszary</b>: Oczyszczacze powietrza sÄ… uruchamiane w trybie manualnym z okreÅ›lonÄ… mocÄ…, gdy poziom PM2.5 znajduje siÄ™ w zdefiniowanym zakresie.<br>
    â° <b>Automatyczne wyÅ‚Ä…czanie</b>: Oczyszczacze powietrza moÅ¼na nadal wyÅ‚Ä…czyÄ‡ rÄ™cznie.
  domain: automation
  input:
    manual_toggle:
      name: PrzeÅ‚Ä…cznik lub encja
      description: PrzeÅ‚Ä…cznik lub encja do rÄ™cznego wÅ‚Ä…czania oczyszczacza powietrza.
      selector:
        entity:
          domain:
            - input_boolean
            - switch
            - light
            - fan
            - binary_sensor
    manual_toggle_state:
      name: Stan przeÅ‚Ä…cznika lub encji
      description: Stan, w ktÃ³rym automatyzacja jest wyzwalana (wÅ‚Ä…czony lub wyÅ‚Ä…czony)
      default: "on"
      selector:
        select:
          options:
            - "on"
            - "off"
    pm2_5_sensor:
      name: Czujnik PM2.5
      description: Czujnik PM2.5 dla oczyszczaczy powietrza
      selector:
        entity:
          domain: sensor
    ppm_threshold_min:
      name: Minimalny prÃ³g PM2.5
      description: Minimalny prÃ³g (PPM) do wÅ‚Ä…czania oczyszczaczy powietrza
      default: 50
      selector:
        number:
          min: 1
          max: 120
          step: 1
    ppm_threshold_max:
      name: Maksymalny prÃ³g PM2.5
      description: Maksymalny prÃ³g (PPM) do uruchamiania oczyszczaczy powietrza
      default: 100
      selector:
        number:
          min: 1
          max: 120
          step: 1
    fan_power:
      name: Moc wentylatora
      description: Procentowa moc wentylatora w trybie manualnym
      default: 60
      selector:
        number:
          min: 10
          max: 100
          step: 10
    fan_entities:
      name: Oczyszczacze powietrza
      description: Encje, obszary lub urzÄ…dzenia wybranych oczyszczaczy powietrza
      selector:
        target:
          entity:
            domain: fan

trigger:
  - platform: state
    entity_id: !input pm2_5_sensor
    id: automanual

condition: []

action:
  - choose:
      # Automatyczne sterowanie oparte na PM2.5
      - conditions:
          - condition: template
            value_template: "{{ trigger.id == 'automanual' }}"
        sequence:
          - delay:
              minutes: 3  # Poczekaj 3 minuty, aby ustaliÄ‡ rzeczywistÄ… wartoÅ›Ä‡ PM2.5
          - condition: numeric_state
            entity_id: !input pm2_5_sensor
            above: !input ppm_threshold_min  # SprawdÅº, czy wartoÅ›Ä‡ PM2.5 jest powyÅ¼ej minimalnego progu
            below: !input ppm_threshold_max  # SprawdÅº, czy wartoÅ›Ä‡ PM2.5 jest poniÅ¼ej maksymalnego progu
          - service: fan.turn_on
            target: !input fan_entities
          - service: fan.set_percentage
            target: !input fan_entities
            data:
              percentage: !input fan_power

mode: single
